<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Customizing Enterprise Worker Configuration - Travis CI</title>
<link rel="stylesheet" href="/assets/stylesheets/main.css">
<link rel="alternate" type="application/rss+xml" title="Travis CI Build Environment Updates" href="http://docs.travis-ci.com/feed.build-env-updates.xml">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" defer></script>
<script src="/assets/javascripts/site.js" type="text/javascript" charset="utf-8" defer></script>
<script src="/assets/javascripts/main.js" type="text/javascript" charset="utf-8" defer></script>
<script src="/assets/javascripts/prism.js" type="text/javascript" charset="utf-8" defer></script>



<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24868285-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head>
  <body>
    <div class="wrapper">

      <header class="top">
  <div class="row topbar">
    <h1 id="logo" class="logo">
  <a href="http://travis-ci.org/" title="Travis CI">Travis</a>
</h1>
    <nav>
      <ul id="navigation" class="navigation">
        <li><a href="http://blog.travis-ci.com">Blog</a></li>
        <li><a href="/">Docs</a></li>
        <li class="toggle"><button type="button" id="toggle-menu" class="button--teal">Menu</button></li>
      </ul>
    </nav>
  </div>
</header>


      <div id="content" class="row">

        <div id="sidebar" class="sidebar">
  <div>
    <!-- <h2>Search</h2> -->
    <div class="searchbox">
      <form>
        <input type="text" id="st-search-input" class="searchbox-input" placeholder="Search the docs" />
      </form>
      <script type="text/javascript">
      var Swiftype = window.Swiftype || {};
        (function() {
          Swiftype.key = 'tXvDDzd4fNTBnLvxfEyx';

      Swiftype.searchSearchFields = {
            "page": ["title, body, tags"]
          };
          Swiftype.autocompleteSearchFields = {
            "page": ["title, body, tags"]
          };
          /** DO NOT EDIT BELOW THIS LINE **/
          var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
          script.src = "//swiftype.com/embed.js";
          var entry = document.getElementsByTagName('script')[0];
          document.getElementsByTagName('script')[0].parentNode.insertBefore(script, entry);
        }());
      </script>
    </div>
  </div>

  <section class="sidebar-navigation">
    <nav>
      <h3>Travis CI Enterprise</h3>
      <ul>
        <li><a href="/user/enterprise/">About Travis CI Enterprise</a></li>
        
          <li><a href="/user/enterprise/prerequisites/">System Prerequisites</a></li>
        
          <li><a href="/user/enterprise/installation/">Installation</a></li>
        
          <li><a href="/user/enterprise/upgrading/">Upgrading</a></li>
        
          <li><a href="/user/enterprise/build-images/">Customizing Build Images</a></li>
        
          <li><a href="/user/enterprise/custom-queues/">Custom Queues</a></li>
        
          <li><a href="/user/enterprise/worker-configuration/">Worker Configuration</a></li>
        
          <li><a href="/user/enterprise/worker-cli-commands/">Worker Start & Debug Containers</a></li>
        
          <li><a href="/user/enterprise/platform-tips/">Platform Administration Tips</a></li>
        
          <li><a href="/user/enterprise/trusty/">Trusty Build Environment</a></li>
        
          <li><a href="/user/enterprise/precise/">Precise (Legacy) Build Environment</a></li>
        
          <li><a href="/user/enterprise/operations-manual/">Operations Manual</a></li>
        
      </ul>
      <h3>Travis CI Docs</h3>
      <ul>
        <li><a href="/">Travis CI Docs</a></li>
      </ul>
    </nav>
  </section>

  <section class="sidebar-notice">
    <p>This documentation site is open source.
      The <a href="https://github.com/travis-ci/docs-travis-ci-com">README in our Git repository</a> explains how to contribute.</p>
  </section>

</div><!-- /#sidebar -->


        <main id="main" class="main" data-swiftype-index='true'>
          
            <aside class="improve-page"><a href="https://github.com/travis-ci/docs-travis-ci-com/edit/master/user/enterprise/worker-configuration.md" target="_blank" title="Edit this page on GitHub" class="button-pen" data-proofer-ignore>Improve this page on GitHub</a></aside>
            <h1 class="title">Customizing Enterprise Worker Configuration</h1>
          
          <div id="toc"></div>

<h2 id="credentials-for-connecting-to-the-platform">Credentials for Connecting to the Platform</h2>

<p>The configuration for connecting to the Travis CI Enterprise Platform,
including the RabbitMQ password, can be found in
<code class="highlighter-rouge">/etc/default/travis-enterprise</code>.</p>

<p>If you need to change the hostname the Worker should connect to, or the
RabbitMQ password, you can do so by updating:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TRAVIS_ENTERPRISE_HOST</span><span class="o">=</span><span class="s2">"enterprise.hostname.corp"</span>
<span class="nb">export </span><span class="nv">TRAVIS_ENTERPRISE_SECURITY_TOKEN</span><span class="o">=</span><span class="s2">"super-secret-password"</span>
</code></pre></div></div>

<h2 id="setting-timeouts">Setting Timeouts</h2>

<p>The following options can be customized in <code class="highlighter-rouge">/etc/default/travis-worker</code>.
It is recommended to have all Workers use the same config.</p>

<p>By default Jobs can run for a maximum of 50 minutes. You can increase or
decrease this using the following setting:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TRAVIS_WORKER_HARD_TIMEOUT</span><span class="o">=</span><span class="s2">"50m"</span>
</code></pre></div></div>

<p>If no log output has been received over 10mins the job is cancelled as
it is assumed the job stalled. You can customize this timeout using the
following setting:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TRAVIS_WORKER_LOG_TIMEOUT</span><span class="o">=</span><span class="s2">"10m"</span>
</code></pre></div></div>

<h2 id="configuring-the-number-of-concurrent-jobs">Configuring the Number of Concurrent Jobs</h2>

<p>The number of concurrent jobs run by the worker and the number of CPUs
allowed for a job to use are configured with the
<code class="highlighter-rouge">TRAVIS_WORKER_POOL_SIZE</code> and <code class="highlighter-rouge">TRAVIS_WORKER_DOCKER_CPUS</code> environment
variables, respectively. Each Job requires a minimum of 2 CPUs, and by
default, each Worker runs 2 Jobs. The product of
<code class="highlighter-rouge">TRAVIS_WORKER_POOL_SIZE * TRAVIS_WORKER_POOL_SIZE</code> cannot exceed the
number of CPUs the worker machine has, otherwise jobs will error and
requeue.</p>

<p>To change the number of concurrent jobs allowed for a worker to use,
please update the following setting:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TRAVIS_WORKER_POOL_SIZE</span><span class="o">=</span><span class="s2">"2"</span>
</code></pre></div></div>

<p>To change the number of CPUs a job is allowed to use, please change the
following setting:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TRAVIS_WORKER_DOCKER_CPUS</span><span class="o">=</span>2
</code></pre></div></div>

<p>To completely disable this setting have the value set to 0. Then
resources will be used as needed, which means a single job can for
example use all CPU cores.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TRAVIS_WORKER_DOCKER_CPUS</span><span class="o">=</span>0
</code></pre></div></div>

<h2 id="changing-the-worker-hostname">Changing the Worker Hostname</h2>

<p>Each Worker should have a unique hostname, making it easier to determine
where jobs ran. By default this is set to the <code class="highlighter-rouge">hostname</code> of the host the
Worker is running on.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TRAVIS_WORKER_HOSTNAME</span><span class="o">=</span><span class="s2">""</span>
</code></pre></div></div>

<h2 id="disable-ssl-verification-messages">Disable SSL Verification Messages</h2>

<p>The Platform comes setup with a self signed SSL certificate, this option
allows the Worker to talk to the Platform via SSL but ignore the
verification warnings.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TRAVIS_WORKER_BUILD_API_INSECURE_SKIP_VERIFY</span><span class="o">=</span><span class="s2">"false"</span>
</code></pre></div></div>

<h2 id="enabling-s3-dependency-caching">Enabling S3 Dependency Caching</h2>

<p>If you would like to setup S3 dependency caching for your builds, you
can use the following example config:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TRAVIS_WORKER_BUILD_CACHE_FETCH_TIMEOUT</span><span class="o">=</span><span class="s2">"10m"</span>
<span class="nb">export </span><span class="nv">TRAVIS_WORKER_BUILD_CACHE_PUSH_TIMEOUT</span><span class="o">=</span><span class="s2">"60m"</span>
<span class="nb">export </span><span class="nv">TRAVIS_WORKER_BUILD_CACHE_S3_ACCESS_KEY_ID</span><span class="o">=</span><span class="s2">""</span>
<span class="nb">export </span><span class="nv">TRAVIS_WORKER_BUILD_CACHE_S3_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="s2">""</span>
<span class="nb">export </span><span class="nv">TRAVIS_WORKER_BUILD_CACHE_S3_BUCKET</span><span class="o">=</span><span class="s2">""</span>
<span class="nb">export </span><span class="nv">TRAVIS_WORKER_BUILD_CACHE_S3_REGION</span><span class="o">=</span><span class="s2">"us-east-1"</span>
<span class="nb">export </span><span class="nv">TRAVIS_WORKER_BUILD_CACHE_S3_SCHEME</span><span class="o">=</span><span class="s2">"https"</span>
<span class="nb">export </span><span class="nv">TRAVIS_WORKER_BUILD_CACHE_TYPE</span><span class="o">=</span><span class="s2">"s3"</span>
</code></pre></div></div>

<h2 id="configuring-jobs-allowed-memory-usage">Configuring Jobs’ Allowed Memory Usage</h2>

<p>The Worker comes configured with the RAM defaulted to 4G. If you want to
change it you can add the following. To completely disable it have the
value set to 0.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TRAVIS_WORKER_DOCKER_MEMORY</span><span class="o">=</span>4G
<span class="c"># OR</span>
<span class="nb">export </span><span class="nv">TRAVIS_WORKER_DOCKER_MEMORY</span><span class="o">=</span>0
</code></pre></div></div>

<h2 id="setting-maximum-log-length">Setting Maximum Log Length</h2>

<p>The Worker comes configured with <code class="highlighter-rouge">defaultMaxLogLength = 4500000</code> which
is 4.5MB. The setting is measured in bytes, so to get 40MB you need
40000000.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TRAVIS_WORKER_MAX_LOG_LENGTH</span><span class="o">=</span>40000000
</code></pre></div></div>

<h2 id="mounting-volumes-across-worker-jobs-on-enterprise">Mounting volumes across worker jobs on Enterprise</h2>

<p>You can use <a href="https://docs.docker.com/storage/bind-mounts/">Docker bind mounts</a>
when the worker launches the container of a job. This let’s you share files or directories 
across all jobs ran by a worker. Multiple binds can be provided
as <em>space separated</em> strings.</p>

<p>For example, the setting below shows how to share the <code class="highlighter-rouge">/tmp</code> directory in read/write mode,
as well as the <code class="highlighter-rouge">/var/log</code> directory in read-only mode (<code class="highlighter-rouge">:r</code> is the default):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TRAVIS_WORKER_DOCKER_BINDS</span><span class="o">=</span><span class="s2">"/tmp:/tmp:rw /var/log"</span>
</code></pre></div></div>

<p>A full list of options and mount modes is listed in the official
 <a href="https://docs.docker.com/storage/bind-mounts/">Docker documentation</a>.</p>

<h2 id="contact-enterprise-support">Contact Enterprise Support</h2>

<p>To get in touch with us, please write a message to 
<a href="mailto:enterprise@travis-ci.com">enterprise@travis-ci.com</a>. If possible, 
please include as much of the following as you can:</p>

<ul>
  <li>Description of the problem - what are you observing?</li>
  <li>Which steps did you try already?</li>
  <li>A support bundle (You can get it from <code class="highlighter-rouge">https://yourdomain:8800/support</code>)</li>
  <li>Log files from all workers (They can be found at <code class="highlighter-rouge">/var/log/upstart/travis-worker.log</code> - please include as many as you can retrieve).</li>
  <li>If a build failed or errored, a text file of the build log</li>
</ul>

<p>Have you made any customizations to your setup? While we may be able to see some 
information (such as hostname, IaaS provider, and license expiration), there 
are many other things we can’t see which could lead to something not working. 
Therefore , we’d like to ask you to also answer the questions below in your 
support request (if applicable):</p>

<ul>
  <li>How many machines are you using?</li>
  <li>Do you use configuration management tools (Chef, Puppet)?</li>
  <li>Which other services do interface with Travis CI Enterprise?</li>
  <li>Do you use Travis CI Enterprise together with github.com or GitHub Enterprise?</li>
  <li>If you’re using GitHub Enterprise, which version of it?</li>
</ul>

<p>We’re looking forward to helping!</p>


        </main>
      </div><!-- /#content -->

      <footer class="footer">
  <div class="inner row">
    <div class="footer-elem">
      <div class="travis-footer">
        <img alt="The Travis CI logo" src="/images/ui/footer-logo.svg"></div>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">&copy;Travis CI, GmbH</h3>
      <address>Rigaer Straße 8<br>10247 Berlin, Germany</address>
      <ul>
        <li><a href="https://docs.travis-ci.com/imprint.html" title="Imprint">Imprint</a></li>
        <li><a href="https://travisci.workable.com/" title="Jobs at Travis CI">Jobs</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Help</h3>
      <ul>
        <li><a href="https://docs.travis-ci.com" title="Travis CI Docs">Documentation</a></li>
        <li><a href="https://blog.travis-ci.com/" title="Travis CI Blog">Blog</a></li>
        <li><a href="mailto:support@travis-ci.com" title="Email Travis CI support">Email</a></li>
        <li><a href="https://twitter.com/travisci" title="Travis CI on Twitter">Twitter</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Travis CI Status</h3>
      <ul>
        <li><div class="status-circle status">Status:</div>
          <a href="http://www.traviscistatus.com/">Travis CI Status</a>
        </li>
      </ul>
    </div>
  </div>
</footer>

    </div><!-- /.wrapper -->
  </body>
</html>
