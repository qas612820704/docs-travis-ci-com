<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Private Dependencies - Travis CI</title>
<link rel="stylesheet" href="/assets/stylesheets/main.css">
<link rel="alternate" type="application/rss+xml" title="Travis CI Build Environment Updates" href="http://docs.travis-ci.com/feed.build-env-updates.xml">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" defer></script>
<script src="/assets/javascripts/site.js" type="text/javascript" charset="utf-8" defer></script>
<script src="/assets/javascripts/main.js" type="text/javascript" charset="utf-8" defer></script>
<script src="/assets/javascripts/prism.js" type="text/javascript" charset="utf-8" defer></script>



<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24868285-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head>
  <body>
    <div class="wrapper">

      <header class="top">
  <div class="row topbar">
    <h1 id="logo" class="logo">
  <a href="http://travis-ci.org/" title="Travis CI">Travis</a>
</h1>
    <nav>
      <ul id="navigation" class="navigation">
        <li><a href="http://blog.travis-ci.com">Blog</a></li>
        <li><a href="/">Docs</a></li>
        <li class="toggle"><button type="button" id="toggle-menu" class="button--teal">Menu</button></li>
      </ul>
    </nav>
  </div>
</header>


      <div id="content" class="row">

        <div id="sidebar" class="sidebar">
  <div>
    <!-- <h2>Search</h2> -->
    <div class="searchbox">
      <form>
        <input type="text" id="st-search-input" class="searchbox-input" placeholder="Search the docs" />
      </form>
      <script type="text/javascript">
      var Swiftype = window.Swiftype || {};
        (function() {
          Swiftype.key = 'tXvDDzd4fNTBnLvxfEyx';

      Swiftype.searchSearchFields = {
            "page": ["title, body, tags"]
          };
          Swiftype.autocompleteSearchFields = {
            "page": ["title, body, tags"]
          };
          /** DO NOT EDIT BELOW THIS LINE **/
          var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
          script.src = "//swiftype.com/embed.js";
          var entry = document.getElementsByTagName('script')[0];
          document.getElementsByTagName('script')[0].parentNode.insertBefore(script, entry);
        }());
      </script>
    </div>
  </div>

  <section class="sidebar-navigation">
    <nav>
      <h3>Getting Started</h3>
      <ul>
        <li><a href="/user/getting-started/">Getting Started</a></li>
        <li><a href="/user/for-beginners/">Core Concepts for Beginners</a></li>
        <li><a href="/user/customizing-the-build/">Customizing Your Build</a></li>
        <li><a href="/user/common-build-problems/">Common Build Problems</a></li>
        <li><a href="/user/speeding-up-the-build/">Speeding up the Build</a></li>
        <li><a href="/user/build-stages/">Build Stages (beta)</a></li>
        <li><a href="/user/docker/">Using Docker in your Build</a></li>
        <li><a href="/user/gui-and-headless-browsers/">Headless Testing with Browsers</a></li>
        <li><a href="/user/pull-requests/">Building Pull Requests</a></li>
        <li><a href="/user/cron-jobs/">Cron Jobs</a></li>
        <li><a href="https://github.com/travis-ci/travis#readme">Command Line Client</a></li>
      </ul>

      <h3>Installing Dependencies</h3>
      <ul>
        <li><a href="/user/installing-dependencies/">Installing Dependencies</a></li>
        <li><a href="/user/private-dependencies/">Private Dependencies</a></li>
        <li><a href="/user/database-setup/">Setting up Services and Databases</a></li>
        <li><a href="/user/caching/">Caching Dependencies</a></li>
        <li><a href="/user/ssh-known-hosts/">Adding to SSH Known Hosts</a></li>

      </ul>
      <h3>Programming Languages</h3>
      <ul>
      
        <li><a href="/user/languages/android/">Android</a></li>
      
        <li><a href="/user/languages/c/">C</a></li>
      
        <li><a href="/user/languages/csharp/">C#</a></li>
      
        <li><a href="/user/languages/cpp/">C++</a></li>
      
        <li><a href="/user/languages/clojure/">Clojure</a></li>
      
        <li><a href="/user/languages/crystal/">Crystal</a></li>
      
        <li><a href="/user/languages/d/">D</a></li>
      
        <li><a href="/user/languages/dart/">Dart</a></li>
      
        <li><a href="/user/languages/erlang/">Erlang</a></li>
      
        <li><a href="/user/languages/elixir/">Elixir</a></li>
      
        <li><a href="/user/languages/csharp/">F#</a></li>
      
        <li><a href="/user/languages/go/">Go</a></li>
      
        <li><a href="/user/languages/groovy/">Groovy</a></li>
      
        <li><a href="/user/languages/haskell/">Haskell</a></li>
      
        <li><a href="/user/languages/haxe/">Haxe</a></li>
      
        <li><a href="/user/languages/java/">Java</a></li>
      
        <li><a href="/user/languages/javascript-with-nodejs/">JavaScript <small>(with Node.js)</small></a></li>
      
        <li><a href="/user/languages/julia/">Julia</a></li>
      
        <li><a href="/user/languages/nix/">Nix</a></li>
      
        <li><a href="/user/languages/objective-c/">Objective-C</a></li>
      
        <li><a href="/user/languages/perl/">Perl</a></li>
      
        <li><a href="/user/languages/perl6/">Perl6</a></li>
      
        <li><a href="/user/languages/php/">PHP</a></li>
      
        <li><a href="/user/languages/python/">Python</a></li>
      
        <li><a href="/user/languages/r/">R</a></li>
      
        <li><a href="/user/languages/ruby/">Ruby</a></li>
      
        <li><a href="/user/languages/rust/">Rust</a></li>
      
        <li><a href="/user/languages/scala/">Scala</a></li>
      
        <li><a href="/user/languages/smalltalk/">Smalltalk</a></li>
      
        <li><a href="/user/languages/objective-c/">Swift</a></li>
      
        <li><a href="/user/languages/csharp/">Visual Basic</a></li>
      
        <li><a href="/user/languages/community-supported-languages/">Adding a language</a></li>
      </ul>

      <h3>Deployments and Uploads</h3>
      <ul>
        <li class="is-overview"><a href="/user/deployment/">Overview</a></li>
        
          <li><a href="/user/deployment/anynines/">anynines</a></li>
        
          <li><a href="/user/deployment/appfog/">Appfog</a></li>
        
          <li><a href="/user/deployment/atlas/">Atlas</a></li>
        
          <li><a href="/user/deployment/codedeploy/">AWS CodeDeploy</a></li>
        
          <li><a href="/user/deployment/elasticbeanstalk/">AWS Elastic Beanstalk</a></li>
        
          <li><a href="/user/deployment/lambda/">AWS Lambda</a></li>
        
          <li><a href="/user/deployment/opsworks/">AWS OpsWorks</a></li>
        
          <li><a href="/user/deployment/s3/">AWS S3</a></li>
        
          <li><a href="/user/deployment/azure-web-apps/">Azure Web Apps</a></li>
        
          <li><a href="/user/deployment/bintray/">bintray</a></li>
        
          <li><a href="/user/deployment/bitballoon/">BitBalloon</a></li>
        
          <li><a href="/user/deployment/bluemixcloudfoundry/">Bluemix CloudFoundry</a></li>
        
          <li><a href="/user/deployment/boxfuse/">Boxfuse</a></li>
        
          <li><a href="/user/deployment/catalyze/">Catalyze</a></li>
        
          <li><a href="/user/deployment/chefsupermarket/">Chef Supermarket</a></li>
        
          <li><a href="/user/deployment/cloud66/">Cloud 66</a></li>
        
          <li><a href="/user/deployment/cloudfoundry/">CloudFoundry</a></li>
        
          <li><a href="/user/deployment/deis/">Deis</a></li>
        
          <li><a href="/user/deployment/engineyard/">Engine Yard</a></li>
        
          <li><a href="/user/deployment/pages/">GitHub Pages</a></li>
        
          <li><a href="/user/deployment/releases/">GitHub Releases</a></li>
        
          <li><a href="/user/deployment/google-app-engine/">Google App Engine</a></li>
        
          <li><a href="/user/deployment/gcs/">Google Cloud Storage</a></li>
        
          <li><a href="/user/deployment/firebase/">Google Firebase</a></li>
        
          <li><a href="/user/deployment/hackage/">Hackage</a></li>
        
          <li><a href="/user/deployment/heroku/">Heroku</a></li>
        
          <li><a href="/user/deployment/launchpad/">Launchpad</a></li>
        
          <li><a href="/user/deployment/modulus/">Modulus</a></li>
        
          <li><a href="/user/deployment/npm/">npm</a></li>
        
          <li><a href="/user/deployment/openshift/">OpenShift</a></li>
        
          <li><a href="/user/deployment/packagecloud/">packagecloud.io</a></li>
        
          <li><a href="/user/deployment/puppetforge/">Puppet Forge</a></li>
        
          <li><a href="/user/deployment/pypi/">PyPI</a></li>
        
          <li><a href="/user/deployment/cloudfiles/">Rackspace Cloud Files</a></li>
        
          <li><a href="/user/deployment/rubygems/">RubyGems</a></li>
        
          <li><a href="/user/deployment/scalingo/">Scalingo</a></li>
        
          <li><a href="/user/deployment/script/">Script</a></li>
        
          <li><a href="/user/deployment/surge/">Surge.sh</a></li>
        
          <li><a href="/user/deployment/testfairy/">TestFairy</a></li>
        
          <li><a href="/user/deployment/snaps/">Ubuntu Snap Store</a></li>
        
        <li><a href="/user/uploading-artifacts/">Uploading Build Artifacts</a></li>
      </ul>

      <h3>CI Environment Reference</h3>
      <ul>
      <li class="is-overview"><a href="/user/reference/overview/">Overview</a></li>
      <li><a href="/user/reference/precise/">Precise CI Environment Reference</a></li>
      <li><a href="/user/reference/trusty/">Trusty CI Environment</a><li>
      <li><a href="/user/reference/osx/">OS X CI Environment Reference</a></li>
      <li><a href="/user/multi-os/">Building on Multiple Operating Systems</a></li>
      <li><a href="/user/environment-variables/">Environment Variables</a></li>
      <li><a href="/user/precise-to-trusty-migration-guide/">Precise to Trusty Migration Guide</a></li>
      <li><a href="/user/build-environment-updates/">Build Environment Updates</a></li>
      <li><a href="/user/ip-addresses/">Build machines IP Addresses</a></li>
      </ul>

      <h3>Encrypting Files and Data</h3>
      <ul>
        <li><a href="/user/encryption-keys/">Encrypting Sensitive Data</a></li>
        <li><a href="/user/encrypting-files/">Encrypting Files</a></li>
        <li><a href="/user/github-oauth-scopes/">GitHub Permissions used by Travis CI</a></li>
        <li><a href="/user/best-practices-security/">Best Practices in Securing Your Data</a></li>
      </ul>

      <h3>Beta Features</h3>
      <ul>
        <li><a href="/user/build-stages/">Build Stages</a></li>
        <li><a href="/user/conditional-builds-stages-jobs/">Conditional Builds, Stages, and Jobs</a></li>
      </ul>

      <h3>Integrations and Notifications</h3>
      <ul>
        <li><a href="/user/notifications/">Configuring Notifications</a></li>
        <li><a href="/user/status-images/">Showing Build Status Images</a></li>
        <li><a href="/user/code-climate/">Code Climate</a></li>
        <li><a href="/user/coveralls/">Coveralls</a></li>
        <li><a href="/user/coverity-scan/">Coverity Scan</a></li>
        <li><a href="/user/browserstack/">BrowserStack</a></li>
        <li><a href="/user/sauce-connect/">Sauce Labs</a></li>
        <li><a href="/user/sonarcloud/">SonarCloud</a></li>
        <li><a href="/user/sourceclear/">SourceClear</a></li>
        <li><a href="/user/build-feeds/">Atom Feeds</a></li>
        <li><a href="/user/cc-menu/">CCMenu / CCTray Feeds</a></li>
        <li><a href="/user/integration/platformio/">Embedded Builds with PlatformIO</a></li>
      </ul>

      <h3>Developer Program</h3>
      <ul>
        <li class="is-overview"><a href="/user/developer/">Overview</a></li>
        <li><a href="http://developer.travis-ci.com/">API V3</a></li>
        <li><a href="/user/triggering-builds/">Triggering Builds with API V3</a></li>
        <li><a href="https://github.com/travis-ci/travis#ruby-library">The Ruby Library</a></li>
      </ul>
      <h3>3rd Party Tools and Resources</h3>
      <ul>
        <li><a href="/user/apps/">Apps, Clients and Tools</a></li>
        <li><a href="https://scan.coverity.com/travis_ci">Coverity Scan</a></li>
      </ul>
      <h3>Travis CI Enterprise</h3>
      <ul>
        <li><a href="/user/enterprise/">Enterprise Docs</a></li>
      </ul>
      <h3>Legal</h3>
      <ul>
        <li><a href="/legal/security/">Security</a></li>
        <li><a href="/legal/terms-conditions/">Terms and Conditions</a></li>
      </ul>
    </nav>
  </section>

  <section class="sidebar-notice">
    <p>This documentation site is open source.
      The <a href="https://github.com/travis-ci/docs-travis-ci-com">README in our Git repository</a> explains how to contribute.</p>
  </section>

</div><!-- /#sidebar -->


        <main id="main" class="main" data-swiftype-index='true'>
          
            <aside class="improve-page" data-swiftype-index='false'><a href="https://github.com/travis-ci/docs-travis-ci-com/edit/master/user/private-dependencies.md" target="_blank" title="Edit this page on GitHub" class="button-pen" data-proofer-ignore>Improve this page on GitHub</a></aside>
            <h1 class="title">Private Dependencies</h1>
          
          <p><em>Some of the features described here are currently <strong>only available for private
*repositories on <a href="https://travis-ci.com">travis-ci.com</a></strong>.</em></p>

<p>When testing a private repository, you might need to pull in other private
repositories as dependencies via <a href="http://git-scm.com/book/en/Git-Tools-Submodules">git
submodules</a>, a custom script,
or a dependency management tool like <a href="http://bundler.io/">Bundler</a> or
<a href="https://getcomposer.org/">Composer</a>.</p>

<p>Git submodules must be cloned early on in the build process, and so must use
either the <a href="#Deploy-Key">Deploy Key</a> or <a href="#User-Key">User Key</a> method.</p>

<p>If the dependency is also on GitHub, there are four different ways of fetching
the repository from within a Travis CI VM. Each one has advantages and
disavantages, so read each method carefully and pick the one that applies best
to your situation.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Authentication</th>
      <th style="text-align: left">Protocol</th>
      <th style="text-align: left">Dependency URL format</th>
      <th style="text-align: left">Gives access to</th>
      <th style="text-align: left">Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong><a href="#Deploy-Key">Deploy Key</a></strong></td>
      <td style="text-align: left">SSH</td>
      <td style="text-align: left"><code class="highlighter-rouge">git@github.com/…</code></td>
      <td style="text-align: left">single repository</td>
      <td style="text-align: left">used by default for main repository</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="#User-Key">User Key</a></strong></td>
      <td style="text-align: left">SSH</td>
      <td style="text-align: left"><code class="highlighter-rouge">git@github.com/…</code></td>
      <td style="text-align: left">all repos user has access to</td>
      <td style="text-align: left"><strong>recommended</strong> for dependencies</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="#Password">Password</a></strong></td>
      <td style="text-align: left">HTTPS</td>
      <td style="text-align: left"><code class="highlighter-rouge">https://…</code></td>
      <td style="text-align: left">all repos user has access to</td>
      <td style="text-align: left">password can be encrypted</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong><a href="#API-Token">API token</a></strong></td>
      <td style="text-align: left">HTTPS</td>
      <td style="text-align: left"><code class="highlighter-rouge">https://…</code></td>
      <td style="text-align: left">all repos user has access to</td>
      <td style="text-align: left">token can be encrypted</td>
    </tr>
  </tbody>
</table>

<p>You can use a <a href="#Dedicated-User-Account">dedicated CI user account</a> for all but
the deploy key approach. This allows you to limit access to a well defined list
of repositories, and make sure that access is read only.</p>

<h2 id="deploy-key">Deploy Key</h2>

<p>GitHub allows to set up SSH keys for a repository. These deploy keys have some great advantages:</p>

<ul>
  <li>They are not bound to a user account, so they will not get invalidated by removing users from a repository.</li>
  <li>They do not give access to other, unrelated repositories.</li>
  <li>The same key can be used for dependencies not stored on GitHub.</li>
</ul>

<p>However, using deploy keys is complicated by the fact that GitHub does not allow you to reuse keys. So a single private key cannot access multiple GitHub repositories.</p>

<p>You could include a different private key for every dependency in the repository, possibly <a href="/user/encrypting-files">encrypting them</a>. Maintaining complex dependency graphs this way can be complex and hard to maintain. For that reason, we recommend using a <a href="#User-Key">user key</a> instead.</p>

<h2 id="user-key">User Key</h2>

<p><em>Custom SSH keys are currently <strong>only available for private repositories on <a href="https://travis-ci.com">travis-ci.com</a></strong>.</em></p>

<p>You can add SSH keys to user accounts on GitHub. Most users have probably already done this to be able to clone the repositories locally.</p>

<p>This way, a single key can access multiple repositories. To limit the list of repositories and type of access, it is recommended to create a <a href="#Dedicated-User-Account">dedicated CI user account</a>.</p>

<h3 id="using-an-existing-key">Using an existing key</h3>

<p><a href="/images/settings-ssh-key.png" class="small right"> <img src="/images/settings-ssh-key.png" alt="Adding an SSH key via the web interface." /> </a></p>

<p>Assumptions:</p>

<ul>
  <li>The repository you are running the builds for is called “myorg/main” and depends on “myorg/lib1” and “myorg/lib2”.</li>
  <li>You have a key already set up on your machine, for instance under <code class="highlighter-rouge">~/.ssh/id_rsa</code> (default on Unix systems).</li>
</ul>

<p>You can add a new key using the repository settings. Paste the contents of <code class="highlighter-rouge">~/.ssh/id_rsa</code> into the “Private Key” text field and give it a nice description.</p>

<p>Alternatively, you can use the following <a href="https://github.com/travis-ci/travis.rb">CLI</a> command to add the key to Travis CI:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>travis sshkey <span class="nt">--upload</span> ~/.ssh/id_rsa <span class="nt">-r</span> myorg/main
Key description: Key to clone myorg/lib1 and myorg/lib2
updating ssh key <span class="k">for </span>myorg/main with key from ~/.ssh/id_rsa
Current SSH key: Key to clone myorg/lib1 and myorg/lib2
</code></pre></div></div>

<p>You can omit the <code class="highlighter-rouge">-r myorg/main</code> if your current working directory is a clone of the “myorg/main” repository.</p>

<h3 id="generating-a-new-key">Generating a new key</h3>

<p>Assumptions:</p>

<ul>
  <li>The repository you are running the builds for is called “myorg/main” and depends on “myorg/lib1” and “myorg/lib2”.</li>
  <li>You know the credentials for a user account that has at least read access to all three repositories.</li>
</ul>

<p>The <code class="highlighter-rouge">travis</code> command line tool can generate a new key for you and set it up on both Travis CI and GitHub. In order to do so, it will ask you for a GitHub user name and password This is very handy if you have just created a <a href="#Dedicated-User-Account">dedicated user</a> or if you don’t have a key set up on your machine that you want to use.</p>

<p>The credentials will only be used to access GitHub and will not be stored or shared with any other service.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>travis sshkey <span class="nt">--generate</span> <span class="nt">-r</span> myorg/main
We need the GitHub login <span class="k">for </span>the account you want to add the key to.
This information will not be sent to Travis CI, only to api.github.com.
The password will not be displayed.

Username: ci-user
Password <span class="k">for </span>ci-user: <span class="k">**************</span>

Generating RSA key.
Uploading public key to GitHub.
Uploading private key to Travis CI.

You can store the private key to reuse it <span class="k">for </span>other repositories <span class="o">(</span>travis sshkey <span class="nt">--upload</span> FILE<span class="o">)</span><span class="nb">.</span>
Store private key? |no|

Current SSH key: key <span class="k">for </span>fetching dependencies <span class="k">for </span>myorg/main
</code></pre></div></div>

<p>You can omit the <code class="highlighter-rouge">-r myorg/main</code> if your current working directory is a clone of the “myorg/main” repository.</p>

<p>At the end of the process, it will ask you whether you want to store the generated key somewhere, usually it is safe to say “no” here. After all, you can just generate a new key as necessary. See <a href="#reusing-a-generated-key">below</a> for instructions on storing and reusing a generated key.</p>

<h3 id="reusing-a-generated-key">Reusing a generated key</h3>

<p>Assumptions:</p>

<ul>
  <li>The repository you are running the builds for is called “myorg/main” and depends on “myorg/lib1” and “myorg/lib2”.</li>
  <li>You know the credentials for a user account that has at least read access to all three repositories.</li>
  <li>You only want to generate a single key, so you can revoke it easily or use it for accessing other sourced for dependencies or deploy targets.</li>
</ul>

<p>This is absolutely optional, nothing keeps you from generating new keys for all the repositories you are testing.</p>

<p>You follow the <a href="#generating-a-new-key">steps above</a>, but choose to store the key. It will ask you for a path to store it under.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>travis sshkey <span class="nt">--generate</span> <span class="nt">-r</span> myorg/main <span class="nt">--description</span> <span class="s2">"CI dependencies"</span>
We need the GitHub login <span class="k">for </span>the account you want to add the key to.
This information will not be sent to Travis CI, only to api.github.com.
The password will not be displayed.

Username: ci-user
Password <span class="k">for </span>ci-user: <span class="k">**************</span>

Generating RSA key.
Uploading public key to GitHub.
Uploading private key to Travis CI.

You can store the private key to reuse it <span class="k">for </span>other repositories <span class="o">(</span>travis sshkey <span class="nt">--upload</span> FILE<span class="o">)</span><span class="nb">.</span>
Store private key? |no| yes
Path: |id_travis_rsa| myorg_key

Current SSH key: CI dependencies
</code></pre></div></div>

<p>And as always, you can omit the <code class="highlighter-rouge">-r myorg/main</code> if your current working directory is a clone of the “myorg/main” repository.</p>

<p>You can then <a href="#using-an-existing-key">upload</a> the key for myorg/main2:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>travis sshkey <span class="nt">--upload</span> myorg_key <span class="nt">-r</span> myorg/main2 <span class="nt">--description</span> <span class="s2">"CI dependencies"</span>
updating ssh key <span class="k">for </span>myorg/main with key from myorg_key
Current SSH key: CI dependencies
</code></pre></div></div>

<p>Starting with the 1.7.0 release of the <code class="highlighter-rouge">travis</code> command line tool, you are able to combine it with the <code class="highlighter-rouge">repos</code> command to set up the key not only for “main” and “main2”, but all repositories under the “myorg” organization.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>travis repos <span class="nt">--active</span> <span class="nt">--owner</span> myorg | xargs <span class="nt">-I</span> % travis sshkey <span class="nt">--upload</span> myorg_key <span class="nt">-r</span> % <span class="nt">--description</span> <span class="s2">"CI dependencies"</span>
updating ssh key <span class="k">for </span>myorg/main with key from myorg_key
Current SSH key: CI dependencies
updating ssh key <span class="k">for </span>myorg/main2 with key from myorg_key
Current SSH key: CI dependencies
updating ssh key <span class="k">for </span>myorg/lib1 with key from myorg_key
Current SSH key: CI dependencies
updating ssh key <span class="k">for </span>myorg/lib2 with key from myorg_key
Current SSH key: CI dependencies
</code></pre></div></div>

<h2 id="password">Password</h2>

<p>Assumptions:</p>

<ul>
  <li>The repository you are running the builds for is called “myorg/main” and depends on “myorg/lib1” and “myorg/lib2”.</li>
  <li>You know the credentials for a user account that has at least read access to all three repositories.</li>
</ul>

<p>To pull in dependencies with a password, you will have to use the user name and password in the Git HTTPS URL: <code class="highlighter-rouge">https://ci-user:mypassword123@github.com/myorg/lib1.git</code>.</p>

<p>Alternatively, you can also write the credentials to the <code class="highlighter-rouge">~/.netrc</code> file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>machine github.com
  login ci-user
  password mypassword123
</code></pre></div></div>

<p>You can also encrypt the password and then write it to the netrc in a <code class="highlighter-rouge">before_install</code> step in your <code class="highlighter-rouge">.travis.yml</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>travis env <span class="nb">set </span>CI_USER_PASSWORD mypassword123 <span class="nt">--private</span> <span class="nt">-r</span> myorg/main
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>before_install:
- <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"machine github.com</span><span class="se">\n</span><span class="s2">  login ci-user</span><span class="se">\n</span><span class="s2">  password </span><span class="nv">$CI_USER_PASSWORD</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> ~/.netrc
</code></pre></div></div>

<p>It is also possible to inject the credentials into URLs, for instance, in a Gemfile, it would look like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>
<span class="n">gemspec</span>

<span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'CI'</span><span class="p">]</span>
  <span class="c1"># use HTTPS with password on Travis CI</span>
  <span class="n">git_source</span> <span class="ss">:github</span> <span class="k">do</span> <span class="o">|</span><span class="n">repo_name</span><span class="o">|</span>
    <span class="n">repo_name</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">"</span> <span class="k">unless</span> <span class="n">repo_name</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
    <span class="s2">"https://ci-user:</span><span class="si">#{</span><span class="no">ENV</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="s2">"CI_USER_PASSWORD"</span><span class="p">)</span><span class="si">}</span><span class="s2">@github.com/</span><span class="si">#{</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">.git"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">gem</span> <span class="s1">'lib1'</span><span class="p">,</span> <span class="ss">github: </span><span class="s2">"myorg/lib1"</span>
<span class="n">gem</span> <span class="s1">'lib2'</span><span class="p">,</span> <span class="ss">github: </span><span class="s2">"myorg/lib2"</span>
</code></pre></div></div>

<blockquote>
  <p>In case of private git submodules, be aware that the <code class="highlighter-rouge">git submodule
update --init recursive</code> command runs before the <code class="highlighter-rouge">~/.netrc</code> credentials
are updated. If you are writing credentials to <code class="highlighter-rouge">~/.netrc</code>, disable the automatic loading of
submodules, update the credentials and add an explicit step to update the submodules:</p>
</blockquote>

<blockquote>
  <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">git</span><span class="pi">:</span>
  <span class="na">submodules</span><span class="pi">:</span>
    <span class="no">false</span>
<span class="na">before_install</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">echo -e "machine github.com\n  login ci-user\n  password $CI_USER_PASSWORD" &gt;&gt;~/.netrc</span>
  <span class="pi">-</span> <span class="s">git submodule update --init --recursive</span>
</code></pre></div>  </div>
</blockquote>

<h2 id="api-token">API Token</h2>

<p>Assumptions:</p>

<ul>
  <li>The repository you are running the builds for is called “myorg/main” and depends on “myorg/lib1” and “myorg/lib2”.</li>
  <li>You know the credentials for a user account that has at least read access to all three repositories.</li>
</ul>

<p>This approach works just like the <a href="#Password">password</a> approach outlined above, except instead of the username/password pair, you use a GitHub API token.</p>

<p>Under the GitHub account settings for the user you want to use, navigate to <a href="https://github.com/settings/applications">Applications</a> and generate a “personal access tokens”. Make sure the token has the “repo” scope.</p>

<p>Your <code class="highlighter-rouge">~/.netrc</code> should look like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>machine github.com
  login the-generated-token
</code></pre></div></div>

<p>You can also use it in URLs directly: <code class="highlighter-rouge">https://the-generated-token@github.com/myorg/lib1.git</code>.</p>

<p>Use the <code class="highlighter-rouge">encrypt</code> command to add the token to your <code class="highlighter-rouge">.travis.yml</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>travis env <span class="nb">set </span>CI_USER_TOKEN the-generated-token <span class="nt">--private</span> <span class="nt">-r</span> myorg/main
</code></pre></div></div>

<p>You can then have Travis CI write to the <code class="highlighter-rouge">~/.netrc</code> on every build.</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">before_install</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">echo -e "machine github.com\n  login $CI_USER_TOKEN" &gt;&gt; ~/.netrc</span>
</code></pre></div></div>

<p>It is also possible to inject the token into URLs, for instance, in a Gemfile, it would look like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>
<span class="n">gemspec</span>

<span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'CI'</span><span class="p">]</span>
  <span class="c1"># use HTTPS with token on Travis CI</span>
  <span class="n">git_source</span> <span class="ss">:github</span> <span class="k">do</span> <span class="o">|</span><span class="n">repo_name</span><span class="o">|</span>
    <span class="n">repo_name</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">"</span> <span class="k">unless</span> <span class="n">repo_name</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
    <span class="s2">"https://</span><span class="si">#{</span><span class="no">ENV</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="s2">"CI_USER_TOKEN"</span><span class="p">)</span><span class="si">}</span><span class="s2">@github.com/</span><span class="si">#{</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">.git"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">gem</span> <span class="s1">'lib1'</span><span class="p">,</span> <span class="ss">github: </span><span class="s2">"myorg/lib1"</span>
<span class="n">gem</span> <span class="s1">'lib2'</span><span class="p">,</span> <span class="ss">github: </span><span class="s2">"myorg/lib2"</span>
</code></pre></div></div>

<blockquote>
  <p>In case of private git submodules, be aware that the <code class="highlighter-rouge">git submodule
update --init recursive</code> command runs before the <code class="highlighter-rouge">~/.netrc</code> credentials
are updated. If you are writing credentials to <code class="highlighter-rouge">~/.netrc</code>, disable the automatic loading of
submodules, update the credentials and add an explicit step to update the submodules:</p>

  <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">git</span><span class="pi">:</span>
  <span class="na">submodules</span><span class="pi">:</span>
    <span class="no">false</span>
<span class="na">before_install</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">echo -e "\n\nmachine github.com\n  $CI_TOKEN\n" &gt;&gt;~/.netrc</span>
  <span class="pi">-</span> <span class="s">git submodule update --init --recursive</span>
</code></pre></div>  </div>
</blockquote>

<h2 id="dedicated-user-account">Dedicated User Account</h2>

<p>As mentioned a few times, it might make sense to create a dedicated CI user for the following reasons:</p>

<ul>
  <li>The CI user will only have access to the repositories you want it to have access to.</li>
  <li>You can limit the access to read access.</li>
  <li>Less risk when it comes to leaking keys or credentials.</li>
  <li>The CI user will not leave the organization for non-technical reasons and accidentally break all your builds.</li>
</ul>

<p>In order to do so, you need to register on GitHub as if you would be signing up for a normal user.  Registering users cannot be automated, since that would violate the GitHub Terms of Service.</p>

        </main>
      </div><!-- /#content -->

      <footer class="footer">
  <div class="inner row">
    <div class="footer-elem">
      <div class="travis-footer">
        <img alt="The Travis CI logo" src="/images/ui/footer-logo.svg"></div>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">&copy;Travis CI, GmbH</h3>
      <address>Rigaer Straße 8<br>10247 Berlin, Germany</address>
      <ul>
        <li><a href="https://docs.travis-ci.com/imprint.html" title="Imprint">Imprint</a></li>
        <li><a href="https://travisci.workable.com/" title="Jobs at Travis CI">Jobs</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Help</h3>
      <ul>
        <li><a href="https://docs.travis-ci.com" title="Travis CI Docs">Documentation</a></li>
        <li><a href="https://blog.travis-ci.com/" title="Travis CI Blog">Blog</a></li>
        <li><a href="mailto:support@travis-ci.com" title="Email Travis CI support">Email</a></li>
        <li><a href="https://twitter.com/travisci" title="Travis CI on Twitter">Twitter</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Travis CI Status</h3>
      <ul>
        <li><div class="status-circle status">Status:</div>
          <a href="http://www.traviscistatus.com/">Travis CI Status</a>
        </li>
      </ul>
    </div>
  </div>
</footer>

    </div><!-- /.wrapper -->
  </body>
</html>
