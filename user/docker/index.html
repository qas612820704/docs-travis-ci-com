<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Using Docker in Builds - Travis CI</title>
<link rel="stylesheet" href="/assets/stylesheets/main.css">
<link rel="alternate" type="application/rss+xml" title="Travis CI Build Environment Updates" href="http://docs.travis-ci.com/feed.build-env-updates.xml">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" defer></script>
<script src="/assets/javascripts/site.js" type="text/javascript" charset="utf-8" defer></script>
<script src="/assets/javascripts/main.js" type="text/javascript" charset="utf-8" defer></script>
<script src="/assets/javascripts/prism.js" type="text/javascript" charset="utf-8" defer></script>



<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24868285-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head>
  <body>
    <div class="wrapper">

      <header class="top">
  <div class="row topbar">
    <h1 id="logo" class="logo">
  <a href="http://travis-ci.org/" title="Travis CI">Travis</a>
</h1>
    <nav>
      <ul id="navigation" class="navigation">
        <li><a href="http://blog.travis-ci.com">Blog</a></li>
        <li><a href="/">Docs</a></li>
        <li class="toggle"><button type="button" id="toggle-menu" class="button--teal">Menu</button></li>
      </ul>
    </nav>
  </div>
</header>


      <div id="content" class="row">

        <div id="sidebar" class="sidebar">
  <div>
    <!-- <h2>Search</h2> -->
    <div class="searchbox">
      <form>
        <input type="text" id="st-search-input" class="searchbox-input" placeholder="Search the docs" />
      </form>
      <script type="text/javascript">
      var Swiftype = window.Swiftype || {};
        (function() {
          Swiftype.key = 'tXvDDzd4fNTBnLvxfEyx';

      Swiftype.searchSearchFields = {
            "page": ["title, body, tags"]
          };
          Swiftype.autocompleteSearchFields = {
            "page": ["title, body, tags"]
          };
          /** DO NOT EDIT BELOW THIS LINE **/
          var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
          script.src = "//swiftype.com/embed.js";
          var entry = document.getElementsByTagName('script')[0];
          document.getElementsByTagName('script')[0].parentNode.insertBefore(script, entry);
        }());
      </script>
    </div>
  </div>

  <section class="sidebar-navigation">
    <nav>
      <h3>Getting Started</h3>
      <ul>
        <li><a href="/user/getting-started/">Getting Started</a></li>
        <li><a href="/user/for-beginners/">Core Concepts for Beginners</a></li>
        <li><a href="/user/customizing-the-build/">Customizing Your Build</a></li>
        <li><a href="/user/common-build-problems/">Common Build Problems</a></li>
        <li><a href="/user/speeding-up-the-build/">Speeding up the Build</a></li>
        <li><a href="/user/build-stages/">Build Stages (beta)</a></li>
        <li><a href="/user/docker/">Using Docker in your Build</a></li>
        <li><a href="/user/gui-and-headless-browsers/">Headless Testing with Browsers</a></li>
        <li><a href="/user/pull-requests/">Building Pull Requests</a></li>
        <li><a href="/user/cron-jobs/">Cron Jobs</a></li>
        <li><a href="https://github.com/travis-ci/travis#readme">Command Line Client</a></li>
      </ul>

      <h3>Installing Dependencies</h3>
      <ul>
        <li><a href="/user/installing-dependencies/">Installing Dependencies</a></li>
        <li><a href="/user/private-dependencies/">Private Dependencies</a></li>
        <li><a href="/user/database-setup/">Setting up Services and Databases</a></li>
        <li><a href="/user/caching/">Caching Dependencies</a></li>
        <li><a href="/user/ssh-known-hosts/">Adding to SSH Known Hosts</a></li>

      </ul>
      <h3>Programming Languages</h3>
      <ul>
      
        <li><a href="/user/languages/android/">Android</a></li>
      
        <li><a href="/user/languages/c/">C</a></li>
      
        <li><a href="/user/languages/csharp/">C#</a></li>
      
        <li><a href="/user/languages/cpp/">C++</a></li>
      
        <li><a href="/user/languages/clojure/">Clojure</a></li>
      
        <li><a href="/user/languages/crystal/">Crystal</a></li>
      
        <li><a href="/user/languages/d/">D</a></li>
      
        <li><a href="/user/languages/dart/">Dart</a></li>
      
        <li><a href="/user/languages/erlang/">Erlang</a></li>
      
        <li><a href="/user/languages/elixir/">Elixir</a></li>
      
        <li><a href="/user/languages/csharp/">F#</a></li>
      
        <li><a href="/user/languages/go/">Go</a></li>
      
        <li><a href="/user/languages/groovy/">Groovy</a></li>
      
        <li><a href="/user/languages/haskell/">Haskell</a></li>
      
        <li><a href="/user/languages/haxe/">Haxe</a></li>
      
        <li><a href="/user/languages/java/">Java</a></li>
      
        <li><a href="/user/languages/javascript-with-nodejs/">JavaScript <small>(with Node.js)</small></a></li>
      
        <li><a href="/user/languages/julia/">Julia</a></li>
      
        <li><a href="/user/languages/nix/">Nix</a></li>
      
        <li><a href="/user/languages/objective-c/">Objective-C</a></li>
      
        <li><a href="/user/languages/perl/">Perl</a></li>
      
        <li><a href="/user/languages/perl6/">Perl6</a></li>
      
        <li><a href="/user/languages/php/">PHP</a></li>
      
        <li><a href="/user/languages/python/">Python</a></li>
      
        <li><a href="/user/languages/r/">R</a></li>
      
        <li><a href="/user/languages/ruby/">Ruby</a></li>
      
        <li><a href="/user/languages/rust/">Rust</a></li>
      
        <li><a href="/user/languages/scala/">Scala</a></li>
      
        <li><a href="/user/languages/smalltalk/">Smalltalk</a></li>
      
        <li><a href="/user/languages/objective-c/">Swift</a></li>
      
        <li><a href="/user/languages/csharp/">Visual Basic</a></li>
      
        <li><a href="/user/languages/community-supported-languages/">Adding a language</a></li>
      </ul>

      <h3>Deployments and Uploads</h3>
      <ul>
        <li class="is-overview"><a href="/user/deployment/">Overview</a></li>
        
          <li><a href="/user/deployment/anynines/">anynines</a></li>
        
          <li><a href="/user/deployment/appfog/">Appfog</a></li>
        
          <li><a href="/user/deployment/atlas/">Atlas</a></li>
        
          <li><a href="/user/deployment/codedeploy/">AWS CodeDeploy</a></li>
        
          <li><a href="/user/deployment/elasticbeanstalk/">AWS Elastic Beanstalk</a></li>
        
          <li><a href="/user/deployment/lambda/">AWS Lambda</a></li>
        
          <li><a href="/user/deployment/opsworks/">AWS OpsWorks</a></li>
        
          <li><a href="/user/deployment/s3/">AWS S3</a></li>
        
          <li><a href="/user/deployment/azure-web-apps/">Azure Web Apps</a></li>
        
          <li><a href="/user/deployment/bintray/">bintray</a></li>
        
          <li><a href="/user/deployment/bitballoon/">BitBalloon</a></li>
        
          <li><a href="/user/deployment/bluemixcloudfoundry/">Bluemix CloudFoundry</a></li>
        
          <li><a href="/user/deployment/boxfuse/">Boxfuse</a></li>
        
          <li><a href="/user/deployment/catalyze/">Catalyze</a></li>
        
          <li><a href="/user/deployment/chefsupermarket/">Chef Supermarket</a></li>
        
          <li><a href="/user/deployment/cloud66/">Cloud 66</a></li>
        
          <li><a href="/user/deployment/cloudfoundry/">CloudFoundry</a></li>
        
          <li><a href="/user/deployment/deis/">Deis</a></li>
        
          <li><a href="/user/deployment/engineyard/">Engine Yard</a></li>
        
          <li><a href="/user/deployment/pages/">GitHub Pages</a></li>
        
          <li><a href="/user/deployment/releases/">GitHub Releases</a></li>
        
          <li><a href="/user/deployment/google-app-engine/">Google App Engine</a></li>
        
          <li><a href="/user/deployment/gcs/">Google Cloud Storage</a></li>
        
          <li><a href="/user/deployment/firebase/">Google Firebase</a></li>
        
          <li><a href="/user/deployment/hackage/">Hackage</a></li>
        
          <li><a href="/user/deployment/heroku/">Heroku</a></li>
        
          <li><a href="/user/deployment/launchpad/">Launchpad</a></li>
        
          <li><a href="/user/deployment/modulus/">Modulus</a></li>
        
          <li><a href="/user/deployment/npm/">npm</a></li>
        
          <li><a href="/user/deployment/openshift/">OpenShift</a></li>
        
          <li><a href="/user/deployment/packagecloud/">packagecloud.io</a></li>
        
          <li><a href="/user/deployment/puppetforge/">Puppet Forge</a></li>
        
          <li><a href="/user/deployment/pypi/">PyPI</a></li>
        
          <li><a href="/user/deployment/cloudfiles/">Rackspace Cloud Files</a></li>
        
          <li><a href="/user/deployment/rubygems/">RubyGems</a></li>
        
          <li><a href="/user/deployment/scalingo/">Scalingo</a></li>
        
          <li><a href="/user/deployment/script/">Script</a></li>
        
          <li><a href="/user/deployment/surge/">Surge.sh</a></li>
        
          <li><a href="/user/deployment/testfairy/">TestFairy</a></li>
        
          <li><a href="/user/deployment/snaps/">Ubuntu Snap Store</a></li>
        
        <li><a href="/user/uploading-artifacts/">Uploading Build Artifacts</a></li>
      </ul>

      <h3>CI Environment Reference</h3>
      <ul>
      <li class="is-overview"><a href="/user/reference/overview/">Overview</a></li>
      <li><a href="/user/reference/precise/">Precise CI Environment Reference</a></li>
      <li><a href="/user/reference/trusty/">Trusty CI Environment</a><li>
      <li><a href="/user/reference/osx/">OS X CI Environment Reference</a></li>
      <li><a href="/user/multi-os/">Building on Multiple Operating Systems</a></li>
      <li><a href="/user/environment-variables/">Environment Variables</a></li>
      <li><a href="/user/precise-to-trusty-migration-guide/">Precise to Trusty Migration Guide</a></li>
      <li><a href="/user/build-environment-updates/">Build Environment Updates</a></li>
      <li><a href="/user/ip-addresses/">Build machines IP Addresses</a></li>
      </ul>

      <h3>Encrypting Files and Data</h3>
      <ul>
        <li><a href="/user/encryption-keys/">Encrypting Sensitive Data</a></li>
        <li><a href="/user/encrypting-files/">Encrypting Files</a></li>
        <li><a href="/user/github-oauth-scopes/">GitHub Permissions used by Travis CI</a></li>
        <li><a href="/user/best-practices-security/">Best Practices in Securing Your Data</a></li>
      </ul>

      <h3>Beta Features</h3>
      <ul>
        <li><a href="/user/build-stages/">Build Stages</a></li>
        <li><a href="/user/conditional-builds-stages-jobs/">Conditional Builds, Stages, and Jobs</a></li>
      </ul>

      <h3>Integrations and Notifications</h3>
      <ul>
        <li><a href="/user/notifications/">Configuring Notifications</a></li>
        <li><a href="/user/status-images/">Showing Build Status Images</a></li>
        <li><a href="/user/code-climate/">Code Climate</a></li>
        <li><a href="/user/coveralls/">Coveralls</a></li>
        <li><a href="/user/coverity-scan/">Coverity Scan</a></li>
        <li><a href="/user/browserstack/">BrowserStack</a></li>
        <li><a href="/user/sauce-connect/">Sauce Labs</a></li>
        <li><a href="/user/sonarcloud/">SonarCloud</a></li>
        <li><a href="/user/sourceclear/">SourceClear</a></li>
        <li><a href="/user/build-feeds/">Atom Feeds</a></li>
        <li><a href="/user/cc-menu/">CCMenu / CCTray Feeds</a></li>
        <li><a href="/user/integration/platformio/">Embedded Builds with PlatformIO</a></li>
      </ul>

      <h3>Developer Program</h3>
      <ul>
        <li class="is-overview"><a href="/user/developer/">Overview</a></li>
        <li><a href="http://developer.travis-ci.com/">API V3</a></li>
        <li><a href="/user/triggering-builds/">Triggering Builds with API V3</a></li>
        <li><a href="https://github.com/travis-ci/travis#ruby-library">The Ruby Library</a></li>
      </ul>
      <h3>3rd Party Tools and Resources</h3>
      <ul>
        <li><a href="/user/apps/">Apps, Clients and Tools</a></li>
        <li><a href="https://scan.coverity.com/travis_ci">Coverity Scan</a></li>
      </ul>
      <h3>Travis CI Enterprise</h3>
      <ul>
        <li><a href="/user/enterprise/">Enterprise Docs</a></li>
      </ul>
      <h3>Legal</h3>
      <ul>
        <li><a href="/legal/security/">Security</a></li>
        <li><a href="/legal/terms-conditions/">Terms and Conditions</a></li>
      </ul>
    </nav>
  </section>

  <section class="sidebar-notice">
    <p>This documentation site is open source.
      The <a href="https://github.com/travis-ci/docs-travis-ci-com">README in our Git repository</a> explains how to contribute.</p>
  </section>

</div><!-- /#sidebar -->


        <main id="main" class="main" data-swiftype-index='true'>
          
            <aside class="improve-page" data-swiftype-index='false'><a href="https://github.com/travis-ci/docs-travis-ci-com/edit/master/user/docker.md" target="_blank" title="Edit this page on GitHub" class="button-pen" data-proofer-ignore>Improve this page on GitHub</a></aside>
            <h1 class="title">Using Docker in Builds</h1>
          
          <div id="toc"></div>

<p>Travis CI builds can run and build Docker images, and can also push images to
Docker repositories or other remote storage.</p>

<p>To use Docker add the following settings to your <code class="highlighter-rouge">.travis.yml</code>:</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">sudo</span><span class="pi">:</span> <span class="s">required</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">docker</span>
</code></pre></div></div>

<p>Then you can add <code class="highlighter-rouge">- docker</code> commands to your build as shown in the following
examples.</p>

<blockquote>
  <p>Travis CI automatically routes builds to run on our Trusty sudo-enabled infrastructure when <code class="highlighter-rouge">services: docker</code> is configured.
We do not currently support use of Docker on OS X.</p>
</blockquote>

<blockquote>
  <p>For information on how to use Docker on Travis CI Enterprise check out <a href="https://docs.travis-ci.com/user/enterprise/build-images/#Enabling-Docker-Builds">Enabling Docker Builds</a>.</p>
</blockquote>

<h3 id="using-a-docker-image-from-a-repository-in-a-build">Using a Docker Image from a Repository in a Build</h3>

<p>This <a href="https://github.com/travis-ci/docker-sinatra">example repository</a> runs two
Docker containers built from the same image:</p>

<ul>
  <li>a Sinatra application</li>
  <li>the Sinatra application test suite</li>
</ul>

<p>After specifying in the <code class="highlighter-rouge">.travis.yml</code> that the worker is using the Docker
enabled environment (with <code class="highlighter-rouge">sudo: required</code> AND <code class="highlighter-rouge">services: - docker</code>) and is
using ruby, the <code class="highlighter-rouge">before_install</code> build step pulls a Docker image from
<a href="https://registry.hub.docker.com/u/carlad/sinatra/">carlad/sinatra</a> then runs</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /root/sinatra<span class="p">;</span> bundle <span class="nb">exec </span>foreman start<span class="p">;</span>
</code></pre></div></div>

<p>in a container built from that image after mapping some ports and paths. Read
the <a href="https://docs.docker.com/">Docker User Guide</a> if you need a
refresher on how to use Docker.</p>

<p>The full <code class="highlighter-rouge">.travis.yml</code> looks like this</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">sudo</span><span class="pi">:</span> <span class="s">required</span>

<span class="na">language</span><span class="pi">:</span> <span class="s">ruby</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">docker</span>

<span class="na">before_install</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">docker pull carlad/sinatra</span>
<span class="pi">-</span> <span class="s">docker run -d -p 127.0.0.1:80:4567 carlad/sinatra /bin/sh -c "cd /root/sinatra; bundle exec foreman start;"</span>
<span class="pi">-</span> <span class="s">docker ps -a</span>
<span class="pi">-</span> <span class="s">docker run carlad/sinatra /bin/sh -c "cd /root/sinatra; bundle exec rake test"</span>

<span class="na">script</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">bundle exec rake test</span>
</code></pre></div></div>

<p>and produces the following <a href="https://travis-ci.org/travis-ci/docker-sinatra">build
output</a>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker ps -a
CONTAINER ID        IMAGE                   COMMAND                CREATED                  STATUS                  PORTS                    NAMES
e376792bce99        carlad/sinatra:latest   "/bin/sh -c 'cd /roo   Less than a second ago   Up Less than a second   127.0.0.1:80-&gt;4567/tcp   condescending_galileo
before_install.4
1.30s$ docker run carlad/sinatra /bin/sh -c "cd /root/sinatra; bundle exec rake test"
/usr/local/bin/ruby -I"lib:test" -I"/usr/local/lib/ruby/2.2.0" "/usr/local/lib/ruby/2.2.0/rake/rake_test_loader.rb" "test/test_app.rb"
Loaded suite /usr/local/lib/ruby/2.2.0/rake/rake_test_loader
Started
.
Finished in 0.022952763 seconds.
------
1 tests, 1 assertions, 0 failures, 0 errors, 0 pendings, 0 omissions, 0 notifications
100% passed
------
43.57 tests/s, 43.57 assertions/s
</code></pre></div></div>

<h3 id="building-a-docker-image-from-a-dockerfile">Building a Docker Image from a Dockerfile</h3>

<p>Instead of downloading the Docker image from
<a href="https://registry.hub.docker.com/u/carlad/sinatra/">carlad/sinatra</a> you can
build it directly from the Dockerfile in the <a href="https://github.com/travis-ci/docker-sinatra/blob/master/Dockerfile">GitHub
respository</a>.</p>

<p>To build the Dockerfile in the current directory, and give it the same
<code class="highlighter-rouge">carlad/sinatra</code> label, change the <code class="highlighter-rouge">docker pull</code> line to:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> carlad/sinatra <span class="nb">.</span>
</code></pre></div></div>

<p>The full <code class="highlighter-rouge">.travis.yml</code> looks like this</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">sudo</span><span class="pi">:</span> <span class="s">required</span>

<span class="na">language</span><span class="pi">:</span> <span class="s">ruby</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">docker</span>

<span class="na">before_install</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">docker build -t carlad/sinatra .</span>
  <span class="pi">-</span> <span class="s">docker run -d -p 127.0.0.1:80:4567 carlad/sinatra /bin/sh -c "cd /root/sinatra; bundle exec foreman start;"</span>
  <span class="pi">-</span> <span class="s">docker ps -a</span>
  <span class="pi">-</span> <span class="s">docker run carlad/sinatra /bin/sh -c "cd /root/sinatra; bundle exec rake test"</span>

<span class="na">script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">bundle exec rake test</span>
</code></pre></div></div>

<h3 id="pushing-a-docker-image-to-a-registry">Pushing a Docker Image to a Registry</h3>

<p>In order to push an image to a registry, one must first authenticate via <code class="highlighter-rouge">docker
login</code>.  The email, username, and password used for login should be stored in
the repository settings environment variables, which may be set up through the
web or locally via the Travis CLI, e.g.:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>travis env <span class="nb">set </span>DOCKER_USERNAME myusername
travis env <span class="nb">set </span>DOCKER_PASSWORD secretsecret
</code></pre></div></div>

<p>Be sure to <a href="/user/environment-variables#Encrypting-environment-variables">encrypt environment variables</a>
using the travis gem.</p>

<p>Within your <code class="highlighter-rouge">.travis.yml</code> prior to attempting a <code class="highlighter-rouge">docker push</code> or perhaps before
<code class="highlighter-rouge">docker pull</code> of a private image, e.g.:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$DOCKER_PASSWORD</span><span class="s2">"</span> | docker login <span class="nt">-u</span> <span class="s2">"</span><span class="nv">$DOCKER_USERNAME</span><span class="s2">"</span> <span class="nt">--password-stdin</span>
</code></pre></div></div>

<h4 id="branch-based-registry-pushes">Branch Based Registry Pushes</h4>

<p>To push a particular branch of your repository to a remote registry,
use the custom deploy section of your <code class="highlighter-rouge">.travis.yml</code>:</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">script</span>
  <span class="na">script</span><span class="pi">:</span> <span class="s">bash docker_push</span>
  <span class="na">on</span><span class="pi">:</span>
    <span class="na">branch</span><span class="pi">:</span> <span class="s">master</span>
</code></pre></div></div>

<p>Where <code class="highlighter-rouge">docker_push</code> is a script in your repository containing:</p>

<div data-file="docker_push" class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$DOCKER_PASSWORD</span><span class="s2">"</span> | docker login <span class="nt">-u</span> <span class="s2">"</span><span class="nv">$DOCKER_USERNAME</span><span class="s2">"</span> <span class="nt">--password-stdin</span>
docker push USER/REPO
</code></pre></div></div>

<h4 id="private-registry-login">Private Registry Login</h4>

<p>When pushing to a private registry, be sure to specify the hostname in the
<code class="highlighter-rouge">docker login</code> command, e.g.:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$DOCKER_PASSWORD</span><span class="s2">"</span> | docker login <span class="nt">-u</span> <span class="s2">"</span><span class="nv">$DOCKER_USERNAME</span><span class="s2">"</span> <span class="nt">--password-stdin</span> registry.example.com
</code></pre></div></div>

<h3 id="using-docker-compose">Using Docker Compose</h3>

<p>The <a href="https://docs.docker.com/compose/">Docker Compose</a> tool is also <a href="/user/reference/trusty/#Docker">installed in the Docker enabled environment</a>.</p>

<p>If needed, you can easily replace this preinstalled version of <code class="highlighter-rouge">docker-compose</code>
by adding the following <code class="highlighter-rouge">before_install</code> step to your <code class="highlighter-rouge">.travis.yml</code>:</p>

<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">env</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">DOCKER_COMPOSE_VERSION=1.4.2</span>

<span class="na">before_install</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">sudo rm /usr/local/bin/docker-compose</span>
  <span class="pi">-</span> <span class="s">curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` &gt; docker-compose</span>
  <span class="pi">-</span> <span class="s">chmod +x docker-compose</span>
  <span class="pi">-</span> <span class="s">sudo mv docker-compose /usr/local/bin</span>
</code></pre></div></div>

<h3 id="installing-a-newer-docker-version">Installing a newer Docker version</h3>

<p>You can upgrade to the latest version and use any new Docker features by manually
updating it in the <code class="highlighter-rouge">before_install</code> step of your <code class="highlighter-rouge">.travis.yml</code>:</p>

<p><strong>Updating from apt.dockerproject.org</strong></p>
<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">before_install</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">sudo apt-get update</span>
  <span class="pi">-</span> <span class="s">sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce</span>
</code></pre></div></div>

<p>Alternatively, you can use <code class="highlighter-rouge">addons</code> instead of <code class="highlighter-rouge">before_install</code> to update via <code class="highlighter-rouge">apt</code> as well:</p>
<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">addons</span><span class="pi">:</span>
  <span class="na">apt</span><span class="pi">:</span>
    <span class="na">packages</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">docker-ce</span>
</code></pre></div></div>

<p><strong>Updating from download.docker.com</strong></p>
<div data-file=".travis.yml" class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">before_install</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span>
  <span class="pi">-</span> <span class="s">sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"</span>
  <span class="pi">-</span> <span class="s">sudo apt-get update</span>
  <span class="pi">-</span> <span class="s">sudo apt-get -y install docker-ce</span>
</code></pre></div></div>

<blockquote>
  <p>Check what version of Docker you’re running with <code class="highlighter-rouge">docker --version</code></p>
</blockquote>

<h4 id="examples">Examples</h4>

<ul>
  <li><a href="https://github.com/heroku/logplex/blob/master/.travis.yml">heroku/logplex</a> (Heroku log router)</li>
  <li><a href="https://github.com/kartoza/docker-pg-backup/blob/master/.travis.yml">kartorza/docker-pg-backup</a> (A cron job that will back up databases running in a docker PostgreSQL container)</li>
</ul>

        </main>
      </div><!-- /#content -->

      <footer class="footer">
  <div class="inner row">
    <div class="footer-elem">
      <div class="travis-footer">
        <img alt="The Travis CI logo" src="/images/ui/footer-logo.svg"></div>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">&copy;Travis CI, GmbH</h3>
      <address>Rigaer Straße 8<br>10247 Berlin, Germany</address>
      <ul>
        <li><a href="https://docs.travis-ci.com/imprint.html" title="Imprint">Imprint</a></li>
        <li><a href="https://travisci.workable.com/" title="Jobs at Travis CI">Jobs</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Help</h3>
      <ul>
        <li><a href="https://docs.travis-ci.com" title="Travis CI Docs">Documentation</a></li>
        <li><a href="https://blog.travis-ci.com/" title="Travis CI Blog">Blog</a></li>
        <li><a href="mailto:support@travis-ci.com" title="Email Travis CI support">Email</a></li>
        <li><a href="https://twitter.com/travisci" title="Travis CI on Twitter">Twitter</a></li>
      </ul>
    </div>

    <div class="footer-elem">
      <h3 class="footer-title">Travis CI Status</h3>
      <ul>
        <li><div class="status-circle status">Status:</div>
          <a href="http://www.traviscistatus.com/">Travis CI Status</a>
        </li>
      </ul>
    </div>
  </div>
</footer>

    </div><!-- /.wrapper -->
  </body>
</html>
